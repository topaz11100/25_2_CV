# 허프 변환(Hough Transform) 실험 보고서

## 1) 이론 요약
허프 변환은 에지(밝기 변화가 큰 지점)로부터 직선을 검출하는 대표적 누적 투표(accumulator voting) 방식이다. 직선 $x\cos\theta + y\sin\theta = \rho$의 매개변수 $(\rho,\theta)$ 공간에서, 영상의 각 에지 픽셀 $(x_i,y_i)$은 $\rho = x_i\cos\theta + y_i\sin\theta$ 곡선을 만든다. 여러 픽셀이 공통 직선을 공유하면 같은 $(\rho,\theta)$ 좌표에 표가 집중되어 피크가 형성되고, 해당 피크가 검출된 직선이 된다.

## 2) 파라미터 정의와 의미
- **에지 임계값 `edge_thresh`**: Sobel로 계산한 $|G_x|+|G_y|$ 크기를 이 값 이상일 때만 에지로 채택한다. 값이 낮을수록 잡음/약한 에지도 포함되고, 높을수록 강한 에지만 남는다.
- **$\theta$ 분할 수 `theta_bins`**: 각도 해상도. 값이 클수록 더 다양한 기울기의 직선을 구분하지만, 연산량과 누적 버킷 희석이 증가한다.
- **$\rho$ 분할 수 `rho_bins`**: 거리 해상도. 영상 대각선 길이 $\rho_{\max}$를 기준으로 $[-\rho_{\max},\rho_{\max}]$를 균등 분할한다. 너무 작으면 동일 직선들이 같은 버킷에 섞여 정밀도가 낮아지고, 너무 크면 피크가 분산되어 검출이 어려워진다.
- **누적 임계값 `acc_thresh`**: 투표 수가 이 값 이상인 버킷만 직선 후보로 채택한다. 낮추면 약한 직선까지, 높이면 강한 직선만 검출된다.
- **`min_len`, `max_gap`(확률적 방식 유사 파라미터)**: 동일한 $(\rho,\theta)$에서 라인 위로 샘플링한 에지 히트들을 **최대 간격 `max_gap`** 기준으로 묶어 세그먼트를 만들고, 길이가 **`min_len`** 이상인 세그먼트만 선분으로 그린다. 이는 OpenCV의 `HoughLinesP`의 `minLineLength`, `maxLineGap`에 상응하는 개념이다.

## 3) 구현 개요
- **에지 검출**: 3×3 Sobel 마스크로 $|G_x|+|G_y|$ 계산 후 임계값으로 이진화. (직접 구현)
- **표 누적**: $\theta$를 `theta_bins`로 균등 분할, 각 에지 픽셀에 대해 $\rho$를 계산해 정수 버킷에 투표.
- **피크 선택**: 누적표가 `acc_thresh` 이상인 버킷을 직선 후보로 선택.
- **세그먼트 추출**: 각 후보 $(\rho,\theta)$에 대해 선 방향으로 픽셀을 1픽셀 간격으로 샘플링하며, 에지 존재 위치를 `max_gap`을 넘어 끊어지지 않는 구간 단위로 묶고 길이가 `min_len` 이상이면 선분으로 출력(브레젠험 라인 그리기).

모든 처리(에지, 허프 누적, 선분 그리기)는 OpenCV 고수준 함수 없이 수작업 구현하였고, 영상 입출력만 OpenCV를 사용하였다.

## 4) 실험 설정
- 입력 영상: 사용자 제공 이미지.
- 기본 파라미터: `edge_thresh=100, theta_bins=180, rho_bins=0(자동), acc_thresh=120, min_len=30, max_gap=5`.
- 실행 예시:
  ```bash
  ./hough input.jpg result --edge_thresh=120 --theta_bins=180 --acc_thresh=150 --min_len=40 --max_gap=5
  ```

생성 산출물:
- `result_edges.png`: 에지 맵
- `result_hough.png`: 검출 선분 오버레이

## 5) 결과 요약(가이드)
- `edge_thresh`를 낮추면 약한 라인과 잡음이 함께 증가 → `acc_thresh`를 다소 올리거나 `max_gap`을 줄이면 과검출을 억제.
- `theta_bins`를 키우면 경사 구분력이 증가하나, 피크가 분산되어 `acc_thresh`를 낮춰야 할 수 있음.
- `rho_bins`를 너무 작게 하면 서로 다른 라인이 합쳐져 위치 오차가 커지고, 너무 크게 하면 피크가 흩어져 누락 가능.
- `min_len`을 키우면 단속적인 짧은 라인은 제거되고 장선 위주로 남음. `max_gap`을 키우면 끊어진 라인을 이어주지만 오검출(잘못된 연결) 위험이 커짐.

## 6) 과제 질의 응답 (Slide 30 기준)
**질문 #1. 약한 Line까지 검출하려면? 장단점은?**  
- 설정 예: `edge_thresh` **낮춤**, `acc_thresh` **낮춤**, `max_gap` **약간 높임**, `min_len` **낮춤**.  
- 장점: 희미한 선분까지 포착.  
- 단점: 잡음 에지/가짜 라인 급증 → 오검출 증가, 후처리 필요.

**질문 #2. 강한 Line만 검출하려면? 장단점은?**  
- 설정 예: `edge_thresh` **상향**, `acc_thresh` **상향**, `min_len` **상향**, `max_gap` **축소**.  
- 장점: 신뢰도 높은 굵은 라인만 남음.  
- 단점: 희미하거나 부분적인 라인은 누락. 구조적으로 중요한 약선이 사라질 수 있음.

## 7) 참고 슬라이드
- 에지와 Sobel, 허프 개념 및 매개변수 설명: 강의 슬라이드(Edge Detection/Line Detection) 참조.
